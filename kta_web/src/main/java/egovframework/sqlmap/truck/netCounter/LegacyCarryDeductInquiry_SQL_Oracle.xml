<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="CarryDeductInquiry">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>	
	<typeAlias  alias="carryDeductInquirySearchVO" type="kr.or.truck.netcounter.inquiryservice.service.ContractInquirySearchVO"/>
	<typeAlias  alias="carryDeductInquiryVO" type="kr.or.truck.netcounter.inquiryservice.service.CarryDeductInquiryVO"/>
	<typeAlias  alias="carryDeductInquiryTransportVO" type="kr.or.truck.netcounter.inquiryservice.service.CarryDeductInquiryTransportVO"/>
	
	<resultMap id="carryDeductInquiry" class="kr.or.truck.netcounter.inquiryservice.service.CarryDeductInquiryVO">		
		<result property="myunchaek_amt" column="MYUNCHAEK_AMT"/>
		<result property="gyeyak_state_nm" column="GYEYAK_STATE_NM"/>
		<result property="napip_gb" column="NAPIP_GB"/>
		<result property="gaip_ymd" column="GAIP_YMD"/>
		<result property="yuhyo_ymd" column="YUHYO_YMD"/>
		<result property="next_bunnap_ymd" column="NEXT_BUNNAP_YMD"/>
		<result property="next_bunnap_amt" column="NEXT_BUNNAP_AMT"/>
		<result property="gyeyak_no" column="GYEYAK_NO"/>
		<result property="agent_nm" column="AGENT_NM"/>
		
		<result property="agent_no" column="AGENT_NO"/>
		<result property="daepyoja_nm" column="DAEPYOJA_NM"/>
		<result property="addr1" column="ADDR1"/>
		<result property="addr2" column="ADDR2"/>
		<result property="tel_local_no" column="TEL_LOCAL_NO"/>
		<result property="tel_no" column="TEL_NO"/>
		<result property="fax_local_no" column="FAX_LOCAL_NO"/>
		<result property="fax_no" column="FAX_NO"/>
		
		<result property="jukjaemul_bosang_hando" column="JUKJAEMUL_BOSANG_HANDO"/>
		<result property="jukjaemul_maechul_amt" column="JUKJAEMUL_MAECHUL_AMT"/>
	</resultMap>
	
	<resultMap id="carryDeductTransportInquiry" class="kr.or.truck.netcounter.inquiryservice.service.CarryDeductInquiryTransportVO">
		<result property="cnt" column="CNT"/>
		<result property="car_gaip_no" column="CAR_GAIP_NO"/>
		<result property="car_no" column="CAR_NO"/>
		<result property="car_kind_nm" column="CAR_KIND_NM"/>
		<result property="jukjaemul_bosang_hando" column="JUKJAEMUL_BOSANG_HANDO"/>
		<result property="myunchaek_amt" column="MYUNCHAEK_AMT"/>
		<result property="gyeyak_state_nm" column="GYEYAK_STATE_NM"/>
		<result property="napip_gb" column="NAPIP_GB"/>
		<result property="gaip_ymd" column="GAIP_YMD"/> 
		<result property="yuhyo_ymd" column="YUHYO_YMD"/>
		<result property="next_bunnap_ymd" column="NEXT_BUNNAP_YMD"/>
		<result property="next_bunnap_amt" column="NEXT_BUNNAP_AMT"/>
		<result property="tukyak_chogwa" column="TUKYAK_CHOGWA"/>
		<result property="tukyak_bunnap" column="TUKYAK_BUNNAP"/>
		<result property="tukyak_a" column="TUKYAK_A"/>
		<result property="tukyak_b" column="TUKYAK_B"/>
		<result property="tukyak_c" column="TUKYAK_C"/>
		<result property="tukyak_d" column="TUKYAK_D"/>
		<result property="tukyak_e" column="TUKYAK_E"/>
		<result property="tukyak_g" column="TUKYAK_G"/>
		<result property="bosang" column="BOSANG"/>
		<result property="bosang_chk" column="BOSANG_CHK"/>
		
		<result property="proper_wg" column="PROPER_WG"/>
		<result property="car_nm" column="CAR_NM"/>
		<result property="car_body_no" column="CAR_BODY_NO"/>
		<result property="car_yy" column="CAR_YY"/>
		<result property="tot_wg" column="TOT_WG"/>
		<result property="sub_unit_tot" column="SUB_UNIT_TOT"/>
		<result property="machine_unit_amt" column="MACHINE_UNIT_AMT"/>
		<result property="top_tank_amt" column="TOP_TANK_AMT"/>
		<result property="gyeyak_gubun_nm" column="GYEYAK_GUBUN_NM"/>
		
		<result property="tukbyul_add_rate" column="TUKBYUL_ADD_RATE"/>
		<result property="tukbyul_rate1_nm" column="TUKBYUL_RATE1_NM"/>
	</resultMap>
	
	
	<resultMap id="carryDeductDetail" class="kr.or.truck.netcounter.inquiryservice.service.DetailVO">	
		<result property="car_no" column="CAR_NO" nullValue="" />
		<result property="gubun_nm" column="GUBUN_NM" nullValue="" />
		<result property="gyeyak_no" column="GYEYAK_NO" nullValue="" />		
		<result property="gyeyak_state_nm" column="GYEYAK_STATE_NM" nullValue="" />
		<result property="bunnap_amt1" column="BUNNAP_AMT1" nullValue="" />
		<result property="youngsu_ymd1" column="YOUNGSU_YMD1" nullValue="" />
		<result property="bunnap_amt2" column="BUNNAP_AMT2" nullValue="" />
		<result property="youngsu_ymd2" column="YOUNGSU_YMD2" nullValue="" />
		<result property="bunnap_amt3" column="BUNNAP_AMT3" nullValue="" />
		<result property="youngsu_ymd3" column="YOUNGSU_YMD3" nullValue="" />
		<result property="bunnap_amt4" column="BUNNAP_AMT4" nullValue="" />
		<result property="youngsu_ymd4" column="YOUNGSU_YMD4" nullValue="" />
		<result property="bunnap_amt5" column="BUNNAP_AMT5" nullValue="" />
		<result property="youngsu_ymd5" column="YOUNGSU_YMD5" nullValue="" />
		<result property="bunnap_amt6" column="BUNNAP_AMT6" nullValue="" />
		<result property="youngsu_ymd6" column="YOUNGSU_YMD6" nullValue="" />									
	</resultMap>
	
	<select id="carryDeductInquiryDAO.selectJusunTotCnt" parameterClass="carryDeductInquirySearchVO" resultClass="integer">
		select count(*) as totCnt
		  from ctgy20 a,
		       ctgy21 b,
		       ctgi01 c
		 where ((#agentcd#      = '1'           and
		         c.saupja_no      = #saupja_no# and
		         c.gyeyak_jibu_cd = #gyeyak_jibu_cd#) or
		        (#agentcd#     != '1'           and 
		         c.agent_no       = #agent_no#  and
		         c.saupjang_seq   = #saupjang_seq#))
		   and c.agent_no         = a.agent_no
		   and c.saupjang_seq     = a.saupjang_seq
		   and a.car_gaip_no      = '9999999999'
		   and a.gyeyak_state_cd     in ('1', '2', '5') 
		   /* and a.gyeyak_state_cd != '8' */ 
		   and a.gyeyak_no        = b.gyeyak_no
		   and a.bunnap_cnt       = b.bunnap_cnt
			<isEqual property="searchCondition" compareValue="detail">
				and a.gyeyak_no = #gyeyak_no#
			</isEqual>
	</select>
			
	<select id="carryDeductInquiryDAO.selectList" parameterClass="carryDeductInquirySearchVO" resultMap="carryDeductInquiry" >
		select c.agent_nm                                                 agent_nm,
		      f_code_nm('1115', a.myunchaek_cd)                          myunchaek_amt,
		      f_code_nm('1004', a.gyeyak_state_cd)                       gyeyak_state_nm,
		      trim(a.bunnap_cnt) || '회/' || trim(a.napip_gb_cd) || '회' napip_gb,
		      substr(a.gyeyak_symd, 1, 4) || '.'   ||
		      substr(a.gyeyak_symd, 5, 2) || '.'   ||
		      substr(a.gyeyak_symd, 7, 2) || ' ~ ' ||
		      substr(a.gyeyak_eymd, 1, 4) || '.'   ||
		      substr(a.gyeyak_eymd, 5, 2) || '.'   ||
		      substr(a.gyeyak_eymd, 7, 2)                                gaip_ymd,
		      substr(b.yuhyo_symd,  1, 4) || '.'   ||
		      substr(b.yuhyo_symd,  5, 2) || '.'   ||
		      substr(b.yuhyo_symd,  7, 2) || ' ~ ' ||
		      substr(b.yuhyo_eymd,  1, 4) || '.'   ||
		      substr(b.yuhyo_eymd,  5, 2) || '.'   ||
		      substr(b.yuhyo_eymd,  7, 2)                                yuhyo_ymd,
		      (case when a.bunnap_cnt = a.napip_gb_cd
		            then ''
		            else (select x.yuhyo_symd
		                    from ctgy21 x
		                   where x.gyeyak_no  = b.gyeyak_no
		                     and x.bunnap_cnt = b.bunnap_cnt + '1')
		      end)                                                       next_bunnap_ymd,
		      (case when a.bunnap_cnt = a.napip_gb_cd
		            then 0
		            else (select y.bunnap_amt
		                    from ctgy21 y
		                   where y.gyeyak_no  = b.gyeyak_no
		                     and y.bunnap_cnt = b.bunnap_cnt + '1')
		      end)                                                       next_bunnap_amt,
		      a.gyeyak_no , /* 계약번호*/
		        a.agent_no  ,
		        c.DAEPYOJA_NM,
		        d.ADDR1,
		        d.ADDR2,
		        d.TEL_LOCAL_NO,
		        d.TEL_NO,
		        d.FAX_LOCAL_NO,
		        d.FAX_NO,
       			f_code_nm('1124', a.jukjaemul_bosang_cd)                   jukjaemul_bosang_hando,/*보상한도*/
       			f_code_nm('1123', a.jukjaemul_maechul_cd)                          jukjaemul_maechul_amt/*매출액*/
		 from ctgy20 a,
		      ctgy21 b,
		      ctgi01 c,
		      ctgi02 d
		where ((#agentcd#      = '1'           and
		        c.saupja_no      = #saupja_no# and
		        c.gyeyak_jibu_cd = #gyeyak_jibu_cd#) or
		       (#agentcd#     != '1'           and 
		        c.agent_no       = #agent_no#  and
		        c.saupjang_seq   = #saupjang_seq#))
		  and c.agent_no         = a.agent_no
		  and c.saupjang_seq     = a.saupjang_seq
		  <isNotEmpty property="gyeyak_gb">
		  and a.car_gaip_no		 !=  '9999999999'      
		  </isNotEmpty>
		  <isEmpty property="gyeyak_gb">
		  and a.car_gaip_no		 =  '9999999999'      
		  </isEmpty>
		  and a.gyeyak_state_cd     in ('1', '2', '5') 
		  /* and a.gyeyak_state_cd != '8' */
		  and a.gyeyak_no        = b.gyeyak_no
		  and a.bunnap_cnt       = b.bunnap_cnt
		  and c.agent_no		 = d.agent_no
		  and c.saupjang_seq     = d.saupjang_seq
		  and c.addr_gb_cd		 = d.addr_gb_cd
			<isEqual property="searchCondition" compareValue="detail">
				and a.gyeyak_no = #gyeyak_no#
			</isEqual>
					<isNotEmpty property="start_acdnt_ymd">
			        	<isNotEmpty property="end_acdnt_ymd">
	        				<![CDATA[and ( #start_acdnt_ymd# < a.gyeyak_eymd and #end_acdnt_ymd# > a.gyeyak_symd )]]>
						</isNotEmpty> 
					</isNotEmpty>
		  
		order by b.gyeyak_no desc
	</select>		

	<select id="carryDeductInquiryDAO.selectJsDetailList" parameterClass="carryDeductInquirySearchVO" resultClass="hashmap">
		select decode(trim(x.car_no), null, x.car_body_no, x.car_no) car_no, 
		       x.gyeyak_no,   
		       decode(x.gubun, '1', '기본계약', '특별약관')          gubun_nm,
		       f_code_nm('1004', x.gyeyak_state_cd)                  gyeyak_state_nm,
		       x.bunnap_amt1,  
		       x.youngsu_ymd1, 
		       x.bunnap_amt2,  
		       x.youngsu_ymd2,  
		       x.bunnap_amt3,  
		       x.youngsu_ymd3, 
		       x.bunnap_amt4,  
		       x.youngsu_ymd4, 
		       x.bunnap_amt5,  
		       x.youngsu_ymd5, 
		       x.bunnap_amt6,  
		       x.youngsu_ymd6,
		       x.gubun
		  from (
		        select a1.car_no                                                                car_no,
		               a1.car_body_no                                                           car_body_no,
		               b1.gyeyak_no                                                             gyeyak_no,
		               max('1')                                                                 gubun,    
		               max(b1.gyeyak_state_cd)                                                  gyeyak_state_cd,
		                                                                                        
		               max(decode(c1.bunnap_cnt, '1', c1.yuhyo_symd,  ''))                      yuhyo_symd1,
		               max(decode(c1.bunnap_cnt, '1', c1.yuhyo_eymd,  ''))                      yuhyo_eymd1,
		               max(decode(c1.bunnap_cnt, '1', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt1,
		               max(decode(c1.bunnap_cnt, '1', c1.youngsu_ymd, ''))                      youngsu_ymd1,
		
		               max(decode(c1.bunnap_cnt, '2', c1.yuhyo_symd,  ''))                      yuhyo_symd2,
		               max(decode(c1.bunnap_cnt, '2', c1.yuhyo_eymd,  ''))                      yuhyo_eymd2,
		               max(decode(c1.bunnap_cnt, '2', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt2,
		               max(decode(c1.bunnap_cnt, '2', c1.youngsu_ymd, ''))                      youngsu_ymd2,
		
		               max(decode(c1.bunnap_cnt, '3', c1.yuhyo_symd,  ''))                      yuhyo_symd3,
		               max(decode(c1.bunnap_cnt, '3', c1.yuhyo_eymd,  ''))                      yuhyo_eymd3,
		               max(decode(c1.bunnap_cnt, '3', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt3,
		               max(decode(c1.bunnap_cnt, '3', c1.youngsu_ymd, ''))                      youngsu_ymd3,
		
		               max(decode(c1.bunnap_cnt, '4', c1.yuhyo_symd,  ''))                      yuhyo_symd4,
		               max(decode(c1.bunnap_cnt, '4', c1.yuhyo_eymd,  ''))                      yuhyo_eymd4,
		               max(decode(c1.bunnap_cnt, '4', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt4,
		               max(decode(c1.bunnap_cnt, '4', c1.youngsu_ymd, ''))                      youngsu_ymd4,
		
		               max(decode(c1.bunnap_cnt, '5', c1.yuhyo_symd,  ''))                      yuhyo_symd5,
		               max(decode(c1.bunnap_cnt, '5', c1.yuhyo_eymd,  ''))                      yuhyo_eymd5,
		               max(decode(c1.bunnap_cnt, '5', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt5,
		               max(decode(c1.bunnap_cnt, '5', c1.youngsu_ymd, ''))                      youngsu_ymd5,
		
		               max(decode(c1.bunnap_cnt, '6', c1.yuhyo_symd,  ''))                      yuhyo_symd6,
		               max(decode(c1.bunnap_cnt, '6', c1.yuhyo_eymd,  ''))                      yuhyo_eymd6,
		               max(decode(c1.bunnap_cnt, '6', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt6,
		               max(decode(c1.bunnap_cnt, '6', c1.youngsu_ymd, ''))                      youngsu_ymd6
		          from ctgi05 a1,
		               ctgy20 b1,
		               ctgy21 c1
		         where a1.car_gaip_no      = '9999999999'
		           and b1.gyeyak_no			= #gyeyak_no#
		           and a1.car_gaip_no      = b1.car_gaip_no
		           
		           and b1.gyeyak_state_cd     in ('1', '2', '5')
				   /*and b1.gyeyak_state_cd != '8' */
				   /* and b1.gyeyak_symd = ( select max(temp.gyeyak_symd) from ctgy20 temp where temp.car_gaip_no = b1.car_gaip_no ) 가장 최신 계약 */
				   
		           and b1.gyeyak_no        = c1.gyeyak_no
		         group by a1.car_no, a1.car_body_no, b1.gyeyak_no
		         
		        union all
		        
		        select a2.car_no                                                car_no,
		               a2.car_body_no                                           car_body_no,
		               b2.gyeyak_no                                             gyeyak_no,
		               max('2')                                                 gubun,    
		               max(b2.gyeyak_state_cd)                                  gyeyak_state_cd,
		                                                                                          
		               max(decode(c2.bunnap_cnt, '1', c2.yuhyo_symd,       '')) yuhyo_symd1,
		               max(decode(c2.bunnap_cnt, '1', c2.yuhyo_eymd,       '')) yuhyo_eymd1,
		               max(decode(c2.bunnap_cnt, '1', c2.tukyak_bunnap_amt, 0)) bunnap_amt1,
		               max(decode(c2.bunnap_cnt, '1', c2.youngsu_ymd,      '')) youngsu_ymd1,
		
		               max(decode(c2.bunnap_cnt, '2', c2.yuhyo_symd,       '')) yuhyo_symd2,
		               max(decode(c2.bunnap_cnt, '2', c2.yuhyo_eymd,       '')) yuhyo_eymd2,
		               max(decode(c2.bunnap_cnt, '2', c2.tukyak_bunnap_amt, 0)) bunnap_amt2,
		               max(decode(c2.bunnap_cnt, '2', c2.youngsu_ymd,      '')) youngsu_ymd2,
		                                                                   
		               max(decode(c2.bunnap_cnt, '3', c2.yuhyo_symd,       '')) yuhyo_symd3,
		               max(decode(c2.bunnap_cnt, '3', c2.yuhyo_eymd,       '')) yuhyo_eymd3,
		               max(decode(c2.bunnap_cnt, '3', c2.tukyak_bunnap_amt, 0)) bunnap_amt3,
		               max(decode(c2.bunnap_cnt, '3', c2.youngsu_ymd,      '')) youngsu_ymd3,
		                                                                    
		               max(decode(c2.bunnap_cnt, '4', c2.yuhyo_symd,       '')) yuhyo_symd4,
		               max(decode(c2.bunnap_cnt, '4', c2.yuhyo_eymd,       '')) yuhyo_eymd4,
		               max(decode(c2.bunnap_cnt, '4', c2.tukyak_bunnap_amt, 0)) bunnap_amt4,
		               max(decode(c2.bunnap_cnt, '4', c2.youngsu_ymd,      '')) youngsu_ymd4,
		                                                                    
		               max(decode(c2.bunnap_cnt, '5', c2.yuhyo_symd,       '')) yuhyo_symd5,
		               max(decode(c2.bunnap_cnt, '5', c2.yuhyo_eymd,       '')) yuhyo_eymd5,
		               max(decode(c2.bunnap_cnt, '5', c2.tukyak_bunnap_amt, 0)) bunnap_amt5,
		               max(decode(c2.bunnap_cnt, '5', c2.youngsu_ymd,      '')) youngsu_ymd5,
		                                                                    
		               max(decode(c2.bunnap_cnt, '6', c2.yuhyo_symd,       '')) yuhyo_symd6,
		               max(decode(c2.bunnap_cnt, '6', c2.yuhyo_eymd,       '')) yuhyo_eymd6,
		               max(decode(c2.bunnap_cnt, '6', c2.tukyak_bunnap_amt, 0)) bunnap_amt6,
		               max(decode(c2.bunnap_cnt, '6', c2.youngsu_ymd,      '')) youngsu_ymd6
		          from ctgi05 a2,
		               ctgy20 b2,
		               ctgy21 c2
		         where a2.car_gaip_no      = '9999999999'
		           and b2.gyeyak_no			= #gyeyak_no#
		           and a2.car_gaip_no      = b2.car_gaip_no
		           and b2.gyeyak_state_cd     in ('1', '2', '5')
				   /*and b2.gyeyak_state_cd != '8' */
				   /*and b2.gyeyak_symd = ( select max(temp.gyeyak_symd) from ctgy20 temp where temp.car_gaip_no = b2.car_gaip_no )  가장 최신 계약 */
				   
		           and b2.gyeyak_no        = c2.gyeyak_no
		         group by a2.car_no, a2.car_body_no, b2.gyeyak_no
		       ) x
		 order by x.car_no, x.gyeyak_no desc, x.gubun
	</select>
	<select id="carryDeductInquiryDAO.selectJsDetailList2" parameterClass="carryDeductInquirySearchVO" resultClass="hashmap">
		select decode(trim(x.car_no), null, x.car_body_no, x.car_no) car_no, 
		       x.gyeyak_no,   
		       decode(x.gubun, '1', '기본계약', '특별약관')          gubun_nm,
		       f_code_nm('1004', x.gyeyak_state_cd)                  gyeyak_state_nm,
		       x.bunnap_amt1,  
		       x.youngsu_ymd1, 
		       x.bunnap_amt2,  
		       x.youngsu_ymd2,  
		       x.bunnap_amt3,  
		       x.youngsu_ymd3, 
		       x.bunnap_amt4,  
		       x.youngsu_ymd4, 
		       x.bunnap_amt5,  
		       x.youngsu_ymd5, 
		       x.bunnap_amt6,  
		       x.youngsu_ymd6,
		       x.gubun
		  from (
		        select a1.car_no                                                                car_no,
		               a1.car_body_no                                                           car_body_no,
		               b1.gyeyak_no                                                             gyeyak_no,
		               max('1')                                                                 gubun,    
		               max(b1.gyeyak_state_cd)                                                  gyeyak_state_cd,
		                                                                                        
		               max(decode(c1.bunnap_cnt, '1', c1.yuhyo_symd,  ''))                      yuhyo_symd1,
		               max(decode(c1.bunnap_cnt, '1', c1.yuhyo_eymd,  ''))                      yuhyo_eymd1,
		               max(decode(c1.bunnap_cnt, '1', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt1,
		               max(decode(c1.bunnap_cnt, '1', c1.youngsu_ymd, ''))                      youngsu_ymd1,
		
		               max(decode(c1.bunnap_cnt, '2', c1.yuhyo_symd,  ''))                      yuhyo_symd2,
		               max(decode(c1.bunnap_cnt, '2', c1.yuhyo_eymd,  ''))                      yuhyo_eymd2,
		               max(decode(c1.bunnap_cnt, '2', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt2,
		               max(decode(c1.bunnap_cnt, '2', c1.youngsu_ymd, ''))                      youngsu_ymd2,
		
		               max(decode(c1.bunnap_cnt, '3', c1.yuhyo_symd,  ''))                      yuhyo_symd3,
		               max(decode(c1.bunnap_cnt, '3', c1.yuhyo_eymd,  ''))                      yuhyo_eymd3,
		               max(decode(c1.bunnap_cnt, '3', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt3,
		               max(decode(c1.bunnap_cnt, '3', c1.youngsu_ymd, ''))                      youngsu_ymd3,
		
		               max(decode(c1.bunnap_cnt, '4', c1.yuhyo_symd,  ''))                      yuhyo_symd4,
		               max(decode(c1.bunnap_cnt, '4', c1.yuhyo_eymd,  ''))                      yuhyo_eymd4,
		               max(decode(c1.bunnap_cnt, '4', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt4,
		               max(decode(c1.bunnap_cnt, '4', c1.youngsu_ymd, ''))                      youngsu_ymd4,
		
		               max(decode(c1.bunnap_cnt, '5', c1.yuhyo_symd,  ''))                      yuhyo_symd5,
		               max(decode(c1.bunnap_cnt, '5', c1.yuhyo_eymd,  ''))                      yuhyo_eymd5,
		               max(decode(c1.bunnap_cnt, '5', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt5,
		               max(decode(c1.bunnap_cnt, '5', c1.youngsu_ymd, ''))                      youngsu_ymd5,
		
		               max(decode(c1.bunnap_cnt, '6', c1.yuhyo_symd,  ''))                      yuhyo_symd6,
		               max(decode(c1.bunnap_cnt, '6', c1.yuhyo_eymd,  ''))                      yuhyo_eymd6,
		               max(decode(c1.bunnap_cnt, '6', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt6,
		               max(decode(c1.bunnap_cnt, '6', c1.youngsu_ymd, ''))                      youngsu_ymd6
		          from ctgi05 a1,
		               ctgy20 b1,
		               ctgy21 c1
		         where a1.car_gaip_no      = '9999999999'
		           and b1.gyeyak_no			= #gyeyak_no#
		           and a1.car_gaip_no      = b1.car_gaip_no
		           
		           and b1.gyeyak_state_cd     in ('1', '2', '5')
				   /*and b1.gyeyak_state_cd != '8' */
				   /* and b1.gyeyak_symd = ( select max(temp.gyeyak_symd) from ctgy20 temp where temp.car_gaip_no = b1.car_gaip_no ) 가장 최신 계약 */
				   
		           and b1.gyeyak_no        = c1.gyeyak_no
		         group by a1.car_no, a1.car_body_no, b1.gyeyak_no
		       ) x
		 order by x.car_no, x.gyeyak_no desc, x.gubun
	</select>
	<select id="carryDeductInquiryDAO.selectJsTukyakList" parameterClass="carryDeductInquirySearchVO" resultClass="hashmap" >
		select 
				 a.tukyak_gubun_cd 
				/*, f_code_etc('1', '1122', a.tukyak_gubun_cd ) as tukyak_gubun_nm*/
				, (select code_name from ct_code01 where code_part = '1122' and code_no = a.tukyak_gubun_cd) as tukyak_gubun_nm
				, tukyak_seq
				, tukyak_symd
				,  decode(tukyak_state_cd, '3', haeji_ymd, tukyak_eymd ) tukyak_eymd
				, ( select max(yuhyo_eymd) from ctgy21 a1
				 	where a1.gyeyak_no = a.gyeyak_no and trim(a1.youngsu_no) is not null) yuhyo_eymd,
				 decode(hwanjuk_yn, '0', '무', '1', '유') hwanjuk_yn	  
		from 	ctgy26 a
		where 	gyeyak_no = #gyeyak_no#
		and 	tukyak_state_cd != '8'
		/*order by tukyak_eymd desc*/
		order by decode(tukyak_gubun_cd, 'A', 1, 'F', 2, 'B', 3, 'C', 4, 'D', 5, 'E', 6, 'G', 7)
	</select>
	

	<select id="carryDeductInquiryDAO.selectCarryDeductTransportTotCnt" parameterClass="carryDeductInquirySearchVO" resultClass="integer" >
		select /*+ index(d IDX_CTGI0506) RULE PARALLEL(4) */
					count(*) as totCnt
		  from ctgy20 a,
		       ctgy21 b,
		       ctgi01 c,
		       ctgi05 d
		 where ((#agentcd#          = '1'           and
		         c.saupja_no          = #saupja_no# and
		         c.gyeyak_jibu_cd  like #gyeyak_jibu_cd#) or
		        (#agentcd#         != '1'           /*	차량관리자가 여러업체 관리할 경우 조회가능하게 조건 삭제함. 	*/))
		   and c.agent_no             = d.agent_no
		   and c.saupjang_seq         = d.saupjang_seq
		   and ((#agentcd# = '1'  and trim(d.carmgr_jumin_no) is null) or
		         d.carmgr_jumin_no like #jumin_no#)
		   and d.car_gaip_no          = a.car_gaip_no
		   and a.gyeyak_state_cd     in ('1', '2', '5') 
	       /* and a.gyeyak_state_cd != '8' */
		   and a.gyeyak_no            = b.gyeyak_no
		   and a.bunnap_cnt           = b.bunnap_cnt
		   /* and a.gyeyak_symd = ( select max(temp.gyeyak_symd) from ctgy20 temp where temp.car_gaip_no = a.car_gaip_no )*/
		   	<isEqual property="searchCondition" compareValue="detail">
				and a.car_gaip_no = #car_gaip_no#
				and a.gyeyak_no = #gyeyak_no#
			</isEqual>
	</select>
 
	<select id="carryDeductInquiryDAO.selectTransportList" parameterClass="carryDeductInquirySearchVO" resultMap="carryDeductTransportInquiry" >
		select 
						
				d.car_nm,	/*차명*/
				d.car_body_no,	/*차대번호*/
				d.car_yy,	/*년식*/
				d.tot_wg,	/*총중량*/
				d.sub_unit_tot,	/*부속품합계액*/
				d.machine_unit_amt,	/*기계가액*/
				d.top_tank_amt,	/*탑및탱크가액*/
		        d.proper_wg                                                       proper_wg,
				f_code_nm('1128', a.gyeyak_gubun_cd)                          gyeyak_gubun_nm,		/*계약구분*/
				
				a.tukbyul_add_rate 											tukbyul_add_rate, /*특별할증(위험요소)*/
		       f_code_nm('1114', a.tukbyul_rate1_cd)                          tukbyul_rate1_nm,
				
				c.agent_nm                                                 agent_nm,
		       d.car_gaip_no                                              car_gaip_no, 
		       decode(trim(d.car_no), null, d.car_body_no, d.car_no)      car_no,
		       f_code_nm('1056', d.car_kind_cd)                           car_kind_nm,
		       f_code_nm('1113', a.jukjaemul_gongje_cd)                   jukjaemul_bosang_hando,
		       f_code_nm('1115', a.myunchaek_cd)                          myunchaek_amt,
		       f_code_nm('1004', a.gyeyak_state_cd)                       gyeyak_state_nm,
		       trim(a.bunnap_cnt) || '회 / ' || trim(a.napip_gb_cd) || '회'           napip_gb,
		       a.gyeyak_eymd                                              gyeyak_eymd,
		       substr(a.gyeyak_symd, 1, 4) || '.' ||
		       substr(a.gyeyak_symd, 5, 2) || '.' ||
		       substr(a.gyeyak_symd, 7, 2) || '~' ||
		       substr(a.gyeyak_eymd, 1, 4) || '.' ||
		       substr(a.gyeyak_eymd, 5, 2) || '.' ||
		       substr(a.gyeyak_eymd, 7, 2)                                gaip_ymd,
		       substr(b.yuhyo_symd,  1, 4) || '.' ||
		       substr(b.yuhyo_symd,  5, 2) || '.' ||
		       substr(b.yuhyo_symd,  7, 2) || '~' ||
		       substr(b.yuhyo_eymd,  1, 4) || '.' ||
		       substr(b.yuhyo_eymd,  5, 2) || '.' ||
		       substr(b.yuhyo_eymd,  7, 2)                                yuhyo_ymd,
		       (case when a.bunnap_cnt = a.napip_gb_cd
		             then ''
		             else (select x.yuhyo_symd
		                     from ctgy21 x
		                    where x.gyeyak_no  = b.gyeyak_no
		                      and x.bunnap_cnt = b.bunnap_cnt + '1')
		       end)                                                       next_bunnap_ymd,
		       (case when a.bunnap_cnt = a.napip_gb_cd
		             then 0
		             else (select y.bunnap_amt
		                     from ctgy21 y
		                    where y.gyeyak_no  = b.gyeyak_no
		                      and y.bunnap_cnt = b.bunnap_cnt + '1')
		       end)                                                       next_bunnap_amt,
		       'O'                                                        tukyak_chogwa,
		       case when a.napip_gb_cd > 1 then 'O' else '' end           tukyak_bunnap,
		       (select decode(x1.tukyak_gubun_cd, 'A', 'O', '')
		          from ctgy26 x1
		         where x1.gyeyak_no = a.gyeyak_no
		           and x1.tukyak_gubun_cd = 'A'
		           and x1.tukyak_state_cd in ('1', '2', '5'))             tukyak_A,
		       (select decode(x2.tukyak_gubun_cd, 'B', 'O', '')
		          from ctgy26 x2
		         where x2.gyeyak_no = a.gyeyak_no
		           and x2.tukyak_gubun_cd = 'B'
		           and x2.tukyak_state_cd in ('1', '2', '5'))             tukyak_B,
		       (select decode(x3.tukyak_gubun_cd, 'C', 'O', '')
		          from ctgy26 x3
		         where x3.gyeyak_no = a.gyeyak_no
		           and x3.tukyak_gubun_cd = 'C'
		           and x3.tukyak_state_cd in ('1', '2', '5'))             tukyak_C,
		       (select decode(x4.tukyak_gubun_cd, 'D', 'O', '')
		          from ctgy26 x4
		         where x4.gyeyak_no = a.gyeyak_no
		           and x4.tukyak_gubun_cd = 'D'
		           and x4.tukyak_state_cd in ('1', '2', '5'))             tukyak_D,
		       (select decode(x5.tukyak_gubun_cd, 'E', 'O', '')
		          from ctgy26 x5
		         where x5.gyeyak_no = a.gyeyak_no
		           and x5.tukyak_gubun_cd = 'E'
		           and x5.tukyak_state_cd in ('1', '2', '5'))             tukyak_E,
		       (select decode(x6.tukyak_gubun_cd, 'G', 'O', '')
		          from ctgy26 x6
		         where x6.gyeyak_no = a.gyeyak_no
		           and x6.tukyak_gubun_cd = 'G'
		           and x6.tukyak_state_cd in ('1', '2', '5'))             tukyak_G,
		       0                                                          cnt,
		       '클릭'                                                     bosang,
		       0                                                          bosang_chk
		  from ctgy20 a,
		       ctgy21 b,
		       ctgi01 c,
		       ctgi05 d
		 where ((#agentcd#          = '1'           
		 		 <isNotEmpty property="saupja_no">
		         and c.saupja_no          = #saupja_no# 
		         </isNotEmpty>
		         <isNotEmpty property="gyeyak_jibu_cd">
		         and c.gyeyak_jibu_cd  like #gyeyak_jibu_cd#
		         </isNotEmpty>
		         ) or
		        (#agentcd#         != '1'           /*	차량관리자가 여러업체 관리할 경우 조회가능하게 조건 삭제함. 	*/))
		   and c.agent_no             = d.agent_no
		   and c.saupjang_seq         = d.saupjang_seq
		   and ((#agentcd# = '1'  and trim(d.carmgr_jumin_no) is null) or
		         d.carmgr_jumin_no like #jumin_no#)
		   and d.car_gaip_no          = a.car_gaip_no		   
		   and a.gyeyak_state_cd     in ('1', '2', '5')
		   /* and a.gyeyak_state_cd != '8' */
		   /* and a.gyeyak_symd = ( select max(temp.gyeyak_symd) from ctgy20 temp where temp.car_gaip_no = a.car_gaip_no )  가장 최신 계약 */
		   
		   and a.gyeyak_no            = b.gyeyak_no
		   and a.bunnap_cnt           = b.bunnap_cnt
		   
		   and a.car_gaip_no = #car_gaip_no#
		   and a.gyeyak_no = #gyeyak_no#
		   
		 order by d.car_no, b.gyeyak_no desc
		
	</select>

	<select id="carryDeductInquiryDAO.selectDetailList" parameterClass="carryDeductInquirySearchVO" resultMap="carryDeductDetail" >
		select decode(trim(x.car_no), null, x.car_body_no, x.car_no) car_no, 
		       x.gyeyak_no,   
		       f_code_nm('1004', x.gyeyak_state_cd)                  gyeyak_state_nm,
		       x.bunnap_amt1,  
		       x.youngsu_ymd1, 
		       x.bunnap_amt2,  
		       x.youngsu_ymd2,  
		       x.bunnap_amt3,  
		       x.youngsu_ymd3, 
		       x.bunnap_amt4,  
		       x.youngsu_ymd4, 
		       x.bunnap_amt5,  
		       x.youngsu_ymd5, 
		       x.bunnap_amt6,  
		       x.youngsu_ymd6
		  from (
		        select a.car_no                                          car_no,
		               a.car_body_no                                     car_body_no,
		               b.gyeyak_no                                       gyeyak_no,    
		               max(b.gyeyak_state_cd)                            gyeyak_state_cd,
		                                                                 
		               max(decode(c.bunnap_cnt, '1', c.yuhyo_symd,  '')) yuhyo_symd1,
		               max(decode(c.bunnap_cnt, '1', c.yuhyo_eymd,  '')) yuhyo_eymd1,
		               max(decode(c.bunnap_cnt, '1', c.bunnap_amt,   0)) bunnap_amt1,
		               max(decode(c.bunnap_cnt, '1', c.youngsu_ymd, '')) youngsu_ymd1,
		                                                                 
		               max(decode(c.bunnap_cnt, '2', c.yuhyo_symd,  '')) yuhyo_symd2,
		               max(decode(c.bunnap_cnt, '2', c.yuhyo_eymd,  '')) yuhyo_eymd2,
		               max(decode(c.bunnap_cnt, '2', c.bunnap_amt,   0)) bunnap_amt2,
		               max(decode(c.bunnap_cnt, '2', c.youngsu_ymd, '')) youngsu_ymd2,
		                                                                 
		               max(decode(c.bunnap_cnt, '3', c.yuhyo_symd,  '')) yuhyo_symd3,
		               max(decode(c.bunnap_cnt, '3', c.yuhyo_eymd,  '')) yuhyo_eymd3,
		               max(decode(c.bunnap_cnt, '3', c.bunnap_amt,   0)) bunnap_amt3,
		               max(decode(c.bunnap_cnt, '3', c.youngsu_ymd, '')) youngsu_ymd3,
		                                                                 
		               max(decode(c.bunnap_cnt, '4', c.yuhyo_symd,  '')) yuhyo_symd4,
		               max(decode(c.bunnap_cnt, '4', c.yuhyo_eymd,  '')) yuhyo_eymd4,
		               max(decode(c.bunnap_cnt, '4', c.bunnap_amt,   0)) bunnap_amt4,
		               max(decode(c.bunnap_cnt, '4', c.youngsu_ymd, '')) youngsu_ymd4,
		
		               max(decode(c.bunnap_cnt, '5', c.yuhyo_symd,  '')) yuhyo_symd5,
		               max(decode(c.bunnap_cnt, '5', c.yuhyo_eymd,  '')) yuhyo_eymd5,
		               max(decode(c.bunnap_cnt, '5', c.bunnap_amt,   0)) bunnap_amt5,
		               max(decode(c.bunnap_cnt, '5', c.youngsu_ymd, '')) youngsu_ymd5,
		                                                                 
		               max(decode(c.bunnap_cnt, '6', c.yuhyo_symd,  '')) yuhyo_symd6,
		               max(decode(c.bunnap_cnt, '6', c.yuhyo_eymd,  '')) yuhyo_eymd6,
		               max(decode(c.bunnap_cnt, '6', c.bunnap_amt,   0)) bunnap_amt6,
		               max(decode(c.bunnap_cnt, '6', c.youngsu_ymd, '')) youngsu_ymd6
		          from ctgi05 a,
		               ctgy06 b,
		               ctgy07 c
		         where a.car_gaip_no      = #car_gaip_no#
		           and a.car_gaip_no      = b.car_gaip_no
		           and b.gyeyak_state_cd in ('1', '2', '5')
		   
				   and b.gyeyak_state_cd     in ('1', '2', '5')
				   /*and b.gyeyak_state_cd != '8' */
				   /*and b.gyeyak_symd = ( select max(temp.gyeyak_symd) from ctgy06 temp where temp.car_gaip_no = b.car_gaip_no )  가장 최신 계약 */
				   
		           and b.gyeyak_no        = c.gyeyak_no
		         group by a.car_no, a.car_body_no, b.gyeyak_no
		       ) x
		 order by x.car_no, x.gyeyak_no desc
	</select>
	<select id="carryDeductInquiryDAO.selectTransportDetailList" parameterClass="carryDeductInquirySearchVO" resultMap="carryDeductDetail" >
		select decode(trim(x.car_no), null, x.car_body_no, x.car_no) car_no, 
		       x.gyeyak_no,   
		       decode(x.gubun, '1', '기본계약', '특별약관')          gubun_nm,
		       f_code_nm('1004', x.gyeyak_state_cd)                  gyeyak_state_nm,
		       x.bunnap_amt1,  
		       x.youngsu_ymd1, 
		       x.bunnap_amt2,  
		       x.youngsu_ymd2,  
		       x.bunnap_amt3,  
		       x.youngsu_ymd3, 
		       x.bunnap_amt4,  
		       x.youngsu_ymd4, 
		       x.bunnap_amt5,  
		       x.youngsu_ymd5, 
		       x.bunnap_amt6,  
		       x.youngsu_ymd6,
		       x.gubun
		  from (
		        select a1.car_no                                                                car_no,
		               a1.car_body_no                                                           car_body_no,
		               b1.gyeyak_no                                                             gyeyak_no,
		               max('1')                                                                 gubun,    
		               max(b1.gyeyak_state_cd)                                                  gyeyak_state_cd,
		                                                                                        
		               max(decode(c1.bunnap_cnt, '1', c1.yuhyo_symd,  ''))                      yuhyo_symd1,
		               max(decode(c1.bunnap_cnt, '1', c1.yuhyo_eymd,  ''))                      yuhyo_eymd1,
		               max(decode(c1.bunnap_cnt, '1', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt1,
		               max(decode(c1.bunnap_cnt, '1', c1.youngsu_ymd, ''))                      youngsu_ymd1,
		
		               max(decode(c1.bunnap_cnt, '2', c1.yuhyo_symd,  ''))                      yuhyo_symd2,
		               max(decode(c1.bunnap_cnt, '2', c1.yuhyo_eymd,  ''))                      yuhyo_eymd2,
		               max(decode(c1.bunnap_cnt, '2', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt2,
		               max(decode(c1.bunnap_cnt, '2', c1.youngsu_ymd, ''))                      youngsu_ymd2,
		
		               max(decode(c1.bunnap_cnt, '3', c1.yuhyo_symd,  ''))                      yuhyo_symd3,
		               max(decode(c1.bunnap_cnt, '3', c1.yuhyo_eymd,  ''))                      yuhyo_eymd3,
		               max(decode(c1.bunnap_cnt, '3', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt3,
		               max(decode(c1.bunnap_cnt, '3', c1.youngsu_ymd, ''))                      youngsu_ymd3,
		
		               max(decode(c1.bunnap_cnt, '4', c1.yuhyo_symd,  ''))                      yuhyo_symd4,
		               max(decode(c1.bunnap_cnt, '4', c1.yuhyo_eymd,  ''))                      yuhyo_eymd4,
		               max(decode(c1.bunnap_cnt, '4', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt4,
		               max(decode(c1.bunnap_cnt, '4', c1.youngsu_ymd, ''))                      youngsu_ymd4,
		
		               max(decode(c1.bunnap_cnt, '5', c1.yuhyo_symd,  ''))                      yuhyo_symd5,
		               max(decode(c1.bunnap_cnt, '5', c1.yuhyo_eymd,  ''))                      yuhyo_eymd5,
		               max(decode(c1.bunnap_cnt, '5', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt5,
		               max(decode(c1.bunnap_cnt, '5', c1.youngsu_ymd, ''))                      youngsu_ymd5,
		
		               max(decode(c1.bunnap_cnt, '6', c1.yuhyo_symd,  ''))                      yuhyo_symd6,
		               max(decode(c1.bunnap_cnt, '6', c1.yuhyo_eymd,  ''))                      yuhyo_eymd6,
		               max(decode(c1.bunnap_cnt, '6', c1.bunnap_amt - c1.tukyak_bunnap_amt, 0)) bunnap_amt6,
		               max(decode(c1.bunnap_cnt, '6', c1.youngsu_ymd, ''))                      youngsu_ymd6
		          from ctgi05 a1,
		               ctgy20 b1,
		               ctgy21 c1
		         where a1.car_gaip_no      = #car_gaip_no#
		           and b1.gyeyak_no			= #gyeyak_no#
		           and a1.car_gaip_no      = b1.car_gaip_no
		           
		           and b1.gyeyak_state_cd     in ('1', '2', '5')
				   /*and b1.gyeyak_state_cd != '8' */
				   /* and b1.gyeyak_symd = ( select max(temp.gyeyak_symd) from ctgy20 temp where temp.car_gaip_no = b1.car_gaip_no ) 가장 최신 계약 */
				   
		           and b1.gyeyak_no        = c1.gyeyak_no
		         group by a1.car_no, a1.car_body_no, b1.gyeyak_no
		         
		        union all
		        
		        select a2.car_no                                                car_no,
		               a2.car_body_no                                           car_body_no,
		               b2.gyeyak_no                                             gyeyak_no,
		               max('2')                                                 gubun,    
		               max(b2.gyeyak_state_cd)                                  gyeyak_state_cd,
		                                                                                          
		               max(decode(c2.bunnap_cnt, '1', c2.yuhyo_symd,       '')) yuhyo_symd1,
		               max(decode(c2.bunnap_cnt, '1', c2.yuhyo_eymd,       '')) yuhyo_eymd1,
		               max(decode(c2.bunnap_cnt, '1', c2.tukyak_bunnap_amt, 0)) bunnap_amt1,
		               max(decode(c2.bunnap_cnt, '1', c2.youngsu_ymd,      '')) youngsu_ymd1,
		
		               max(decode(c2.bunnap_cnt, '2', c2.yuhyo_symd,       '')) yuhyo_symd2,
		               max(decode(c2.bunnap_cnt, '2', c2.yuhyo_eymd,       '')) yuhyo_eymd2,
		               max(decode(c2.bunnap_cnt, '2', c2.tukyak_bunnap_amt, 0)) bunnap_amt2,
		               max(decode(c2.bunnap_cnt, '2', c2.youngsu_ymd,      '')) youngsu_ymd2,
		                                                                   
		               max(decode(c2.bunnap_cnt, '3', c2.yuhyo_symd,       '')) yuhyo_symd3,
		               max(decode(c2.bunnap_cnt, '3', c2.yuhyo_eymd,       '')) yuhyo_eymd3,
		               max(decode(c2.bunnap_cnt, '3', c2.tukyak_bunnap_amt, 0)) bunnap_amt3,
		               max(decode(c2.bunnap_cnt, '3', c2.youngsu_ymd,      '')) youngsu_ymd3,
		                                                                    
		               max(decode(c2.bunnap_cnt, '4', c2.yuhyo_symd,       '')) yuhyo_symd4,
		               max(decode(c2.bunnap_cnt, '4', c2.yuhyo_eymd,       '')) yuhyo_eymd4,
		               max(decode(c2.bunnap_cnt, '4', c2.tukyak_bunnap_amt, 0)) bunnap_amt4,
		               max(decode(c2.bunnap_cnt, '4', c2.youngsu_ymd,      '')) youngsu_ymd4,
		                                                                    
		               max(decode(c2.bunnap_cnt, '5', c2.yuhyo_symd,       '')) yuhyo_symd5,
		               max(decode(c2.bunnap_cnt, '5', c2.yuhyo_eymd,       '')) yuhyo_eymd5,
		               max(decode(c2.bunnap_cnt, '5', c2.tukyak_bunnap_amt, 0)) bunnap_amt5,
		               max(decode(c2.bunnap_cnt, '5', c2.youngsu_ymd,      '')) youngsu_ymd5,
		                                                                    
		               max(decode(c2.bunnap_cnt, '6', c2.yuhyo_symd,       '')) yuhyo_symd6,
		               max(decode(c2.bunnap_cnt, '6', c2.yuhyo_eymd,       '')) yuhyo_eymd6,
		               max(decode(c2.bunnap_cnt, '6', c2.tukyak_bunnap_amt, 0)) bunnap_amt6,
		               max(decode(c2.bunnap_cnt, '6', c2.youngsu_ymd,      '')) youngsu_ymd6
		          from ctgi05 a2,
		               ctgy20 b2,
		               ctgy21 c2
		         where a2.car_gaip_no      = #car_gaip_no#
		           and b2.gyeyak_no			= #gyeyak_no#
		           and a2.car_gaip_no      = b2.car_gaip_no
		           and b2.gyeyak_state_cd     in ('1', '2', '5')
				   /*and b2.gyeyak_state_cd != '8' */
				   /*and b2.gyeyak_symd = ( select max(temp.gyeyak_symd) from ctgy20 temp where temp.car_gaip_no = b2.car_gaip_no )  가장 최신 계약 */
				   
		           and b2.gyeyak_no        = c2.gyeyak_no
		         group by a2.car_no, a2.car_body_no, b2.gyeyak_no
		       ) x
		 order by x.car_no, x.gyeyak_no desc, x.gubun
	</select>
	
	<select id="carryDeductInquiryDAO.selectJusunList" parameterClass="carryDeductInquirySearchVO" resultClass="hashmap">
		select a.agent_no,
		       a.saupjang_seq ,
		       f_agent_nm(a.agent_no, a.saupjang_seq) agent_nm,
		       a.gyeyak_no,
		       f_code_nm('1004', a.gyeyak_state_cd) as gyeyak_state_cd,
		       to_char(to_number(a.myunchaek_cd) * 10) || '만원' myunchaek_amt,
		       (select code_name
		          from ct_code01
		         where code_part = '1124'
		           and code_no   = jukjaemul_bosang_cd) bosang_hando,
		       to_char(to_date(a.gyeyak_symd,'yymmdd'),'yyyy.mm.dd')     gyeyak_symd,
		       to_char(to_date(a.gyeyak_eymd,'yymmdd'),'yyyy.mm.dd')     gyeyak_eymd,
		       a.bundam_amt,
		       a.tot_napip_amt,
		       a.bunnap_cnt,
		       a.napip_gb_cd,
		       case when a.bunnap_cnt <![CDATA[ < ]]> a.napip_gb_cd
		            then (
		                  select yuhyo_symd
		                    from ctgy21
		                   where gyeyak_no  = a.gyeyak_no
		                     and bunnap_cnt = to_char(to_number(a.bunnap_cnt) + 1)
		                 )
		            else '' end yuhyo_symd,
		       case when a.bunnap_cnt <![CDATA[ < ]]> a.napip_gb_cd
		            then (
		                  select bunnap_amt
		                    from ctgy21
		                   where gyeyak_no  = a.gyeyak_no
		                     and bunnap_cnt = to_char(to_number(a.bunnap_cnt) + 1)
		                 )
		            else 0 end bunnap_amt,
		        nvl((select count(distinct bb04.acdnt_no)
				 from cpaa03 aa03,
				      cpaa04 bb04,
				      cpaa01 cc01
				where cc01.acdnt_ymd >= to_char(sysdate, 'yyyy') - '3' || to_char(sysdate, 'MMdd')
				  and bb04.agent_no = a.agent_no
				  and bb04.saupjang_seq     = a.saupjang_seq
				  and bb04.acdnt_no    = aa03.acdnt_no
				  and cc01.acdnt_no = aa03.acdnt_no
				  and aa03.dmbo_gb    in ('5')
				  and bb04.gyeyak_no_juk4 is not null
				  group by bb04.agent_no || bb04.saupjang_seq), 0)       as bosang_cnt 
		  from ctgy20 a,
		       tb_member_saupno@kotmaswb b
		 where 1=1
		  <isNotEmpty property="agent_no_array">
			<iterate property="agent_no_array" open="and b.saupnum in (" conjunction="," close=")">
				#agent_no_array[]#
			</iterate>
		  </isNotEmpty>
		  <isEmpty property="agent_no">
				 <isNotEmpty property="tb_agent_array">
					<iterate property="tb_agent_array" open="and a.agent_no||a.saupjang_seq in (" conjunction="," close=")">
						#tb_agent_array[]#
					</iterate>
				 </isNotEmpty>
		  </isEmpty>
		  <isNotEmpty property="agent_no">
       	  		<isNotEmpty property="saupjang_seq">
				   and a.agent_no       = #agent_no#
				   and a.saupjang_seq   = #saupjang_seq#				       
              	</isNotEmpty>
            </isNotEmpty>
           and a.agent_no     = b.agent_no
		   and a.saupjang_seq = b.saupjang_seq
		   and a.gyeyak_kind_cd   = 'B'
		   and a.gyeyak_state_cd in ('1', '2', '5')
		   <isNotEmpty property="gyeyak_jibu_cd">
			and b.gyeyak_jibu = #gyeyak_jibu_cd#
		   </isNotEmpty>
		   <isNotEmpty property="start_acdnt_ymd">
			<isNotEmpty property="end_acdnt_ymd">
				<![CDATA[ and ( #start_acdnt_ymd# < a.gyeyak_eymd and #end_acdnt_ymd# > a.gyeyak_symd )]]>
			</isNotEmpty> 
		   </isNotEmpty>	
		 order by a.gyeyak_no

	</select>
</sqlMap>